title: PQ Login Successful
description: This will show all successful logins. Change end of line 16 to false to see internal and external logins.
author: NerbalOne
date: 08/18/2022
modified:
mitre: 
   tactic: 
   technique: 
   subtechnique: 
operating_system: windows
query:
//This will show all successful external logins
event.category = 'logins'
not (event.login.userName contains ("$", "HealthMailbox"))
| let rfc1918 = not ($src.endpoint.ip.address matches "((127\\..*)|(192\\.168\..*)|(10\\..*)|(172\\.1[6-9]\\..*)|(172\\.2[0-9]\\..*)|(172\\.3[0-1]\\..*)).*")
| filter rfc1918 = true
| group NumberOfSuccessfulAttempts = count(event.login.loginIsSuccessful=true)
by event.login.userName, endpoint.name, src.endpoint.ip.address, event.login.accountDomain, event.login.type
| sort -NumberOfSuccessfulAttempts
false_positives:
   - Line 14 can be removed or edited if you don't want to exclude usernames containing "$" or "HealthMailbox".
tags:
   - 
references:
   -
