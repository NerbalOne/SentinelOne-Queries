title: PQ CVE-2023-23397 Process Behavior
description: This PQ will show CVE-2023-23397 process behavior.
author: NerbalOne
date: 03/16/2023
modified:
mitreID: T1550
   technique: Use Alternate Authentication Material
   tactic: Defense Evasion, Lateral Movement    
   subtechnique: Pass the Hash
operating_system: windows
query:
// This will show CVE-2023-23397 process behavior.
// Both filters CANNOT be set to true at the same time.
// Change the end of line 11 to true to see connections to internal IPs.
// Change the end of line 13 to false to see connections to FQDNs.
// Line 10 is a Regex to match internal IPs.
// Line 12 is a Regex to match external IPs.
src.process.image.path contains "svchost.exe"
tgt.process.image.path contains "rundll32.exe"
tgt.process.cmdline contains "davclnt.dll,DavSetCookie"
| let rfc1918 = tgt.process.cmdline matches "((127\\..*)|(192\\.168\..*)|(10\\..*)|(172\\.1[6-9]\\..*)|(172\\.2[0-9]\\..*)|(172\\.3[0-1]\\..*)).*"
| filter rfc1918 = false
| let UNC = tgt.process.cmdline matches "^(?:(?:(?:[1-9]?\d|1\d\d|2[0-4]\d|25[0-5])\.){3}(?:[1-9]?\d|1\d\d|2[0-4]\d|25[0-5])|(?:9\d|1\d\d|2(?:[0-4]\d|5[0-3]))(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}|(?:9\d|1\d\d|2(?:[0-4]\d|5[0-3]))(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}\.(?:1?\d{1,2}|2[0-4]\d|25[0-4]))$"
| filter UNC = true
| columns event.time, endpoint.name,  src.process.image.path, tgt.process.image.path, tgt.process.cmdline
false_positives:
   - 
tags:
   - CVE-2023-23397
references:
   - https://twitter.com/_JohnHammond/status/1636197908084305922
status: experimental
